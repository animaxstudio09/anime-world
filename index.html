<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="referrer" content="no-referrer-when-downgrade">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ANIMAX PREMIUM </title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #060606; --primary: #e50914; --gold: #ffd700; --card: #181818; --text: #ffffff; }
        body { margin: 0; font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; }

        /* 1. Login Background Setup */
        #login-screen { 
            height: 100vh; display: none; flex-direction: column; justify-content: center; align-items: center;
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.9)), 
                        url('https://images.alphacoders.com/132/1327173.png');
            background-size: cover; background-position: center; text-align: center;
        }
        .login-card { background: rgba(0,0,0,0.65); padding: 45px; border-radius: 20px; backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.15); box-shadow: 0 15px 40px rgba(0,0,0,0.8); }

        /* 2. Navigation */
        nav { padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.98); position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid #222; }
        .logo { color: var(--primary); font-size: 26px; font-weight: 800; letter-spacing: 1px; }
        .profile-trigger img { width: 42px; height: 42px; border-radius: 50%; border: 2px solid var(--gold); padding: 2px; cursor: pointer; transition: 0.3s; }
        .profile-trigger:hover img { transform: scale(1.1); }

        /* 3. Queen Dashboard (Side Menu) */
        .sidebar { position: fixed; top: 0; right: -320px; width: 300px; height: 100%; background: #111; z-index: 2000; transition: 0.4s; padding: 40px 20px; border-left: 2.5px solid var(--gold); box-sizing: border-box; text-align: center; }
        .sidebar.active { right: 0; }
        .sidebar img { width: 85px; height: 85px; border-radius: 50%; border: 3px solid var(--gold); margin-bottom: 15px; }
        .u-badge { background: var(--gold); color: #000; padding: 4px 18px; border-radius: 20px; font-size: 11px; font-weight: 800; margin-bottom: 20px; display: inline-block; }

        /* 4. Redeem Section */
        .redeem-box { background: #1a1a1a; padding: 15px; border-radius: 15px; margin-top: 25px; border: 1.5px dashed var(--gold); }
        .redeem-box input { width: 100%; padding: 12px; border-radius: 8px; border: none; background: #000; color: #fff; text-align: center; margin-bottom: 12px; box-sizing: border-box; font-weight: 600; }

        /* 5. Grid System (Playlist & All Anime) */
        .section-header { padding: 25px 5% 5px; font-size: 19px; color: var(--gold); font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(155px, 1fr)); gap: 18px; padding: 15px 5%; }
        .card { background: var(--card); border-radius: 12px; overflow: hidden; border: 1px solid #222; cursor: pointer; transition: 0.3s; position: relative; }
        .card:hover { transform: translateY(-8px); border-color: var(--primary); box-shadow: 0 10px 20px rgba(229, 9, 20, 0.2); }
        .card img { width: 100%; height: 230px; object-fit: cover; }
        .card h3 { padding: 12px; font-size: 12.5px; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .p-tag { position: absolute; top: 12px; left: 12px; background: var(--gold); color: #000; padding: 3px 10px; font-size: 10px; font-weight: 800; border-radius: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.5); }

        /* Buttons */
        .btn { width: 100%; padding: 14px; border-radius: 10px; border: none; font-weight: 800; cursor: pointer; transition: 0.3s; font-size: 14px; }
        .btn-red { background: var(--primary); color: #fff; }
        .btn-gold { background: var(--gold); color: #000; }

        /* Video Modal */
        #vid-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; }
        .close-vid { position: absolute; top: 25px; right: 35px; font-size: 45px; color: #fff; cursor: pointer; z-index: 5001; text-shadow: 0 0 10px #000; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h1 style="color:var(--primary); font-size: 50px; margin: 0; font-weight: 800;">ANIMAX</h1>
            <p style="color:#eee; margin-bottom: 35px; font-size: 14px; opacity: 0.8;">Premium Anime Streaming by RJ ROCKY</p>
            <button class="btn btn-red" onclick="signIn()" style="width:auto; padding: 16px 50px; border-radius: 50px; text-transform: uppercase;">LOGIN WITH GOOGLE</button>
        </div>
    </div>

    <div id="main-app" style="display:none;">
        <nav>
            <div class="logo">ANIMAX</div>
            <div class="profile-trigger" onclick="toggleSidebar()"><img id="u-img" src=""></div>
        </nav>

        <div id="history-sec" style="display:none;">
            <div class="section-header"><span>üïí</span> RECENTLY WATCHED</div>
            <div class="grid" id="history-grid"></div>
        </div>

        <div class="section-header"><span>üî•</span> DISCOVER ANIME</div>
        <div class="grid" id="anime-list"></div>

        <div class="sidebar" id="side-menu">
            <img id="d-img" src="">
            <h3 id="u-name" style="margin:0; font-size: 20px;">User</h3>
            <p id="u-email" style="font-size: 11px; color: #777; margin-bottom: 5px;">user@gmail.com</p>
            <div class="u-badge" id="u-status">FREE MEMBER</div>
            
            <div class="redeem-box">
                <p style="font-size: 12px; margin-bottom: 12px; color: var(--gold); font-weight: 700;">REDEEM PREMIUM KEY</p>
                <input type="text" id="key-input" placeholder="Enter 30-Day Code">
                <button class="btn btn-gold" onclick="redeemKey()">ACTIVATE NOW</button>
            </div>

            <button class="btn btn-red" style="margin-top: 30px;" onclick="contactAdmin()">BUY PREMIUM (TELEGRAM)</button>
            <p onclick="auth.signOut()" style="margin-top: 25px; cursor: pointer; font-size: 13px; color: #555; font-weight: 600;">Sign Out Account</p>
            <p onclick="toggleSidebar()" style="margin-top: 20px; cursor: pointer; color: #888; font-size: 12px;">Close Panel</p>
        </div>
    </div>

    <div id="vid-modal">
        <span class="close-vid" onclick="closeVideo()">&times;</span>
        <iframe id="vid-frame" src="" allow="autoplay; fullscreen" allowfullscreen></iframe>
    </div>

    <script>
        // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Firebase ‡¶ï‡¶®‡¶´‡¶ø‡¶ó
        const firebaseConfig = {
            apiKey: "AIzaSyBcWE5TCxamMSnJxqSm5X4mgSwSccIXcBI",
            authDomain: "myanimeapp-8d079.firebaseapp.com",
            databaseURL: "https://myanimeapp-8d079-default-rtdb.firebaseio.com",
            projectId: "myanimeapp-8d079",
            storageBucket: "myanimeapp-8d079.firebasestorage.app",
            messagingSenderId: "37482342893",
            appId: "1:37482342893:web:bebc7352e4bc102b725fe4"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let currentUser = null;
        let isPremium = false;

        function signIn() { auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }

        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                document.getElementById('u-img').src = user.photoURL;
                document.getElementById('d-img').src = user.photoURL;
                document.getElementById('u-name').innerText = user.displayName;
                document.getElementById('u-email').innerText = user.email;

                checkPremiumStatus();
                loadHistory();
                loadAllContent();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('main-app').style.display = 'none';
            }
        });

        // ‡¶™‡ßç‡¶∞‡¶ø‡¶Æ‡¶ø‡¶Ø‡¶º‡¶æ‡¶Æ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï
        function checkPremiumStatus() {
            db.ref('users/' + currentUser.uid).on('value', snap => {
                const data = snap.val();
                if (data && data.premiumUntil > Date.now()) {
                    isPremium = true;
                    document.getElementById('u-status').innerText = "QUEEN PREMIUM ACTIVE";
                    document.getElementById('u-status').style.background = "#ffd700";
                } else {
                    isPremium = false;
                    document.getElementById('u-status').innerText = "FREE MEMBER";
                }
            });
        }

        // ‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ ‡¶ï‡ßÄ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
        function redeemKey() {
            const key = document.getElementById('key-input').value.trim();
            if(!key) return alert("Please enter a key!");

            db.ref('premium_codes/' + key).once('value', snap => {
                if (snap.exists() && snap.val().status === 'active') {
                    const expiry = Date.now() + (30 * 24 * 60 * 60 * 1000);
                    db.ref('users/' + currentUser.uid).update({ premiumUntil: expiry });
                    db.ref('premium_codes/' + key).update({ status: 'used', usedBy: currentUser.email });
                    alert("Awesome! 30 Days Premium Unlocked.");
                    toggleSidebar();
                } else {
                    alert("Invalid or Expired Key! Contact RJ ROCKY.");
                }
            });
        }

        // ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶Ö‡¶ü‡ßã-‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶≤‡¶ú‡¶ø‡¶ï [cite: 2026-01-31]
        function contactAdmin() {
            const message = encodeURIComponent(`Hello RJ ROCKY,\nI want to purchase a 30-Day Premium Key.\n\nUser Detail:\nName: ${currentUser.displayName}\nEmail: ${currentUser.email}`);
            window.open(`https://t.me/aminezone09?text=${message}`, '_blank');
        }

        // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶•‡¶æ‡¶Æ‡ßç‡¶¨‡¶®‡ßá‡¶á‡¶≤ ‡¶ì ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶°
        function loadAllContent() {
            db.ref('anime').on('value', snap => {
                const list = document.getElementById('anime-list');
                list.innerHTML = "";
                snap.forEach(child => {
                    const v = child.val();
                    const isP = v.title.toLowerCase().includes("premium");
                    list.innerHTML += `
                        <div class="card" onclick="watchVideo('${v.url}', '${v.title}', '${v.thumbnail}', ${isP})">
                            ${isP ? '<div class="p-tag">PREMIUM</div>' : ''}
                            <img src="${v.thumbnail}" onerror="this.src='https://via.placeholder.com/200x300?text=Poster+Missing'">
                            <h3>${v.title}</h3>
                        </div>`;
                });
            });
        }

        // ‡¶™‡ßç‡¶≤‡ßá-‡¶≤‡¶ø‡¶∏‡ßç‡¶ü/‡¶ì‡¶Ø‡¶º‡¶æ‡¶ö ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø ‡¶≤‡ßã‡¶°
        function loadHistory() {
            db.ref('playlists/' + currentUser.uid).limitToLast(10).on('value', snap => {
                const grid = document.getElementById('history-grid');
                grid.innerHTML = "";
                if (snap.exists()) {
                    document.getElementById('history-sec').style.display = 'block';
                    snap.forEach(child => {
                        const v = child.val();
                        grid.innerHTML += `
                            <div class="card" onclick="playVideo('${v.url}')">
                                <img src="${v.thumbnail}" onerror="this.src='https://via.placeholder.com/200x300?text=Poster+Missing'">
                                <h3>${v.title}</h3>
                            </div>`;
                    });
                } else {
                    document.getElementById('history-sec').style.display = 'none';
                }
            });
        }

        // ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶™‡ßç‡¶≤‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶≤‡ßá-‡¶≤‡¶ø‡¶∏‡ßç‡¶ü‡ßá ‡¶∏‡ßá‡¶≠ ‡¶≤‡¶ú‡¶ø‡¶ï
        function watchVideo(url, title, thumb, isP) {
            if (isP && !isPremium) {
                alert("This is a Premium Video. Please redeem a key from your profile!");
                toggleSidebar();
                return;
            }
            // ‡¶è‡¶∞‡¶∞ ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶Ü‡¶á‡¶°‡¶ø ‡¶ï‡ßç‡¶≤‡¶ø‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            const cleanId = btoa(url).substring(0, 25).replace(/[^a-zA-Z0-9]/g, "");
            db.ref('playlists/' + currentUser.uid + '/' + cleanId).set({url, title, thumbnail: thumb});
            playVideo(url);
        }

        function playVideo(url) {
            let finalUrl = url;
            if (url.includes("youtube.com/watch?v=")) finalUrl = url.replace("watch?v=", "embed/");
            if (url.includes("drive.google.com")) finalUrl = url.replace("/view", "/preview");
            
            document.getElementById('vid-modal').style.display = 'block';
            document.getElementById('vid-frame').src = finalUrl;
        }

        function toggleSidebar() { document.getElementById('side-menu').classList.toggle('active'); }
        function closeVideo() { document.getElementById('vid-modal').style.display = 'none'; document.getElementById('vid-frame').src = ""; }
    </script>
</body>
                                                                                   </html>
    
